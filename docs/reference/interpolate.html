<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Interpolate — interpolate • terra</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Interpolate — interpolate" />
<meta property="og:description" content="Make a SpatRaster with interpolated values using a fitted model object of classes such as &quot;gstat&quot; (gstat package) or &quot;Krige&quot; (fields package). That is, these are models that have location (&quot;x&quot; and &quot;y&quot;, or &quot;longitude&quot; and &quot;latitude&quot;) as independent variables. If x and y are the only independent variables provide an empty (no associated data in memory or on file) SpatRaster for which you want predictions. If there are more spatial predictor variables provide these as a SpatRaster in the first argument of the function. If you do not have x and y locations as implicit predictors in your model you should use predict instead." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">terra</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1-16</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rspatial/terra/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Interpolate</h1>
    
    <div class="hidden name"><code>interpolate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Make a SpatRaster with interpolated values using a fitted model object of classes such as "gstat" (gstat package) or "Krige" (fields package). That is, these are models that have location ("x" and "y", or "longitude" and "latitude") as independent variables. If x and y are the only independent variables provide an empty (no associated data in memory or on file) SpatRaster for which you want predictions. If there are more spatial predictor variables provide these as a SpatRaster in the first argument of the function. If you do not have x and y locations as implicit predictors in your model you should use <code><a href='predict.html'>predict</a></code> instead.</p>
    </div>

    <pre class="usage"><span class='co'># S4 method for SpatRaster</span>
<span class='fu'>interpolate</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>model</span>, fun<span class='op'>=</span><span class='va'>predict</span>, <span class='va'>...</span>, 
       xyNames<span class='op'>=</span><span class='fu'><a href='c.html'>c</a></span><span class='op'>(</span><span class='st'>"x"</span>, <span class='st'>"y"</span><span class='op'>)</span>, factors<span class='op'>=</span><span class='cn'>NULL</span>, const<span class='op'>=</span><span class='cn'>NULL</span>, index <span class='op'>=</span> <span class='cn'>NULL</span>, 
     na.rm<span class='op'>=</span><span class='cn'>FALSE</span>, filename<span class='op'>=</span><span class='st'>""</span>, overwrite<span class='op'>=</span><span class='cn'>FALSE</span>, wopt<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>object</th>
      <td><p>SpatRaster</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>model object</p></td>
    </tr>
    <tr>
      <th>fun</th>
      <td><p>function. Default value is "predict", but can be replaced with e.g. "predict.se" (depending on the class of <code>model</code>)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments passed to <code>fun</code></p></td>
    </tr>
    <tr>
      <th>xyNames</th>
      <td><p>character. variable names that the model uses for the spatial coordinates. E.g., <code><a href='c.html'>c("longitude", "latitude")</a></code></p></td>
    </tr>
    <tr>
      <th>factors</th>
      <td><p>list with levels for factor variables. The list elements should be named with names that correspond to names in <code>object</code> such that they can be matched. This argument may be omitted for many models as the predict function will extract the levels from the <code>model</code> object</p></td>
    </tr>
    <tr>
      <th>const</th>
      <td><p>data.frame. Can be used to add a constant for which there is no SpatRaster for model predictions. This is particularly useful if the constant is a character-like factor value</p></td>
    </tr>
    <tr>
      <th>index</th>
      <td><p>positive integer or NULL. Allows for selecting of the variable returned if the model returns multiple variables</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>logical. If <code>TRUE</code>, cells with <code>NA</code> values in the predictors are removed from the computation. This option prevents errors with models that cannot handle <code>NA</code> values. In most other cases this will not affect the output. An exception is when predicting with a model that returns predicted values even if some (or all!) variables are <code>NA</code></p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>character. Output filename</p></td>
    </tr>
    <tr>
      <th>overwrite</th>
      <td><p>logical. If <code>TRUE</code>, <code>filename</code> is overwritten</p></td>
    </tr>
    <tr>
      <th>wopt</th>
      <td><p>list with named options for writing files as in <code><a href='writeRaster.html'>writeRaster</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>SpatRaster</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='predict.html'>predict</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>r</span> <span class='op'>&lt;-</span> <span class='fu'><a href='rast.html'>rast</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"ex/test.tif"</span>, package<span class='op'>=</span><span class='st'>"terra"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>ra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='aggregate.html'>aggregate</a></span><span class='op'>(</span><span class='va'>r</span>, <span class='fl'>10</span><span class='op'>)</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='fu'><a href='xyRowColCell.html'>xyFromCell</a></span><span class='op'>(</span><span class='va'>ra</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='dimensions.html'>ncell</a></span><span class='op'>(</span><span class='va'>ra</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>v</span> <span class='op'>&lt;-</span> <span class='fu'><a href='values.html'>values</a></span><span class='op'>(</span><span class='va'>ra</span><span class='op'>)</span>
<span class='va'>i</span> <span class='op'>&lt;-</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>)</span>
<span class='va'>xy</span> <span class='op'>&lt;-</span> <span class='va'>xy</span><span class='op'>[</span><span class='va'>i</span>,<span class='op'>]</span>
<span class='va'>v</span> <span class='op'>&lt;-</span> <span class='va'>v</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>

<span class='co'>#library(fields) </span>
<span class='co'>#tps &lt;- Tps(xy, v)</span>
<span class='co'>#p &lt;- rast(r)</span>

<span class='co'>## use model to predict values at all locations</span>
<span class='co'>#p &lt;- interpolate(p, tps)</span>
<span class='co'>#p &lt;- mask(p, r)</span>
<span class='co'>#plot(p)</span>


<span class='co'>### change "fun" from predict to fields::predictSE to get the TPS standard error</span>
<span class='co'>## need to use "rast(p)" to remove the values</span>
<span class='co'>#se &lt;- interpolate(rast(p), tps, fun=predictSE)</span>
<span class='co'>#se &lt;- mask(se, r)</span>
<span class='co'>#plot(se)</span>

<span class='co'>### another variable; let's call it elevation</span>
<span class='co'>#elevation &lt;- (init(r, 'x') * init(r, 'y')) / 100000000</span>
<span class='co'>#names(elevation) &lt;- 'elev'</span>

<span class='co'>#z &lt;- as.matrix(extract(elevation, xy))</span>

<span class='co'>## add as another independent variable</span>
<span class='co'>#xyz &lt;- cbind(xy, z)</span>
<span class='co'>#tps2 &lt;- Tps(xyz, v)</span>
<span class='co'>#p2 &lt;- interpolate(elevation, tps2, xyOnly=FALSE)</span>

<span class='co'>## as a linear coveriate</span>
<span class='co'>#tps3 &lt;- Tps(xy, v, Z=z)</span>

<span class='co'>## Z is a separate argument in Krig.predict, so we need a new function</span>
<span class='co'>## Internally (in interpolate) a matrix is formed of x, y, and elev (Z)</span>

<span class='co'>#pfun &lt;- function(model, x, ...) {</span>
<span class='co'>#   predict(model, x[,1:2], Z=x[,3], ...)</span>
<span class='co'>#}</span>
<span class='co'>#p3 &lt;- interpolate(elevation, tps3, fun=pfun)</span>


<span class='co'>#### gstat examples</span>
<span class='co'>#library(gstat)</span>
<span class='co'>#library(sp)</span>
<span class='co'>#data(meuse)</span>

<span class='co'>### inverse distance weighted (IDW)</span>
<span class='co'>#r &lt;- rast(system.file("ex/test.tif", package="terra"))</span>
<span class='co'>#mg &lt;- gstat(id = "zinc", formula = zinc~1, locations = ~x+y, data=meuse, </span>
<span class='co'>#            nmax=7, set=list(idp = .5))</span>
<span class='co'>#z &lt;- interpolate(r, mg, debug.level=0)</span>
<span class='co'>#z &lt;- mask(z, r)</span>

<span class='co'>### kriging</span>

<span class='co'>### ordinary kriging</span>
<span class='co'>#v &lt;- variogram(log(zinc)~1, ~x+y, data=meuse)</span>
<span class='co'>#mv &lt;- fit.variogram(v, vgm(1, "Sph", 300, 1))</span>
<span class='co'>#gOK &lt;- gstat(NULL, "log.zinc", log(zinc)~1, meuse, locations=~x+y, model=mv)</span>
<span class='co'>#OK &lt;- interpolate(r, gOK, debug.level=0)</span>

<span class='co'>## universal kriging</span>
<span class='co'>#vu &lt;- variogram(log(zinc)~elev, ~x+y, data=meuse)</span>
<span class='co'>#mu &lt;- fit.variogram(vu, vgm(1, "Sph", 300, 1))</span>
<span class='co'>#gUK &lt;- gstat(NULL, "log.zinc", log(zinc)~elev, meuse, locations=~x+y, model=mu)</span>
<span class='co'>#names(r) &lt;- "elev"</span>
<span class='co'>#UK &lt;- interpolate(r, gUK, debug.level=0)</span>

<span class='co'>## co-kriging</span>
<span class='co'>#gCoK &lt;- gstat(NULL, 'log.zinc', log(zinc)~1, meuse, locations=~x+y)</span>
<span class='co'>#gCoK &lt;- gstat(gCoK, 'elev', elev~1, meuse, locations=~x+y)</span>
<span class='co'>#gCoK &lt;- gstat(gCoK, 'cadmium', cadmium~1, meuse, locations=~x+y)</span>
<span class='co'>#gCoK &lt;- gstat(gCoK, 'copper', copper~1, meuse, locations=~x+y)</span>
<span class='co'>#coV &lt;- variogram(gCoK)</span>
<span class='co'>#plot(coV, type='b', main='Co-variogram')</span>
<span class='co'>#coV.fit &lt;- fit.lmc(coV, gCoK, vgm(model='Sph', range=1000))</span>
<span class='co'>#coV.fit</span>
<span class='co'>#plot(coV, coV.fit, main='Fitted Co-variogram')</span>
<span class='co'>#coK &lt;- interpolate(r, coV.fit, debug.level=0)</span>
<span class='co'>#plot(coK)</span>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Robert J. Hijmans.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


